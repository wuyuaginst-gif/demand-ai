<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>éœ€æ±‚ç®¡ç† AI åŠ©æ‰‹</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    [v-cloak] { display: none; }
    .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
    .fade-enter-from, .fade-leave-to { opacity: 0; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">
  <div id="app" v-cloak>
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <nav class="bg-white shadow-sm border-b">
      <div class="max-w-6xl mx-auto px-4 py-4">
        <div class="flex items-center justify-between">
          <h1 class="text-xl font-bold text-gray-800">ğŸ¤– éœ€æ±‚ç®¡ç† AI åŠ©æ‰‹</h1>
          <div class="flex items-center space-x-2">
            <span class="w-2 h-2 rounded-full" :class="serverStatus === 'online' ? 'bg-green-500' : 'bg-red-500'"></span>
            <span class="text-sm text-gray-600">{{ serverStatus === 'online' ? 'æœåŠ¡æ­£å¸¸' : 'æœåŠ¡ç¦»çº¿' }}</span>
          </div>
        </div>
      </div>
    </nav>

    <div class="max-w-6xl mx-auto px-4 py-6">
      <!-- Tab åˆ‡æ¢ -->
      <div class="flex space-x-1 bg-white rounded-lg p-1 shadow-sm mb-6">
        <button 
          v-for="tab in tabs" 
          :key="tab.id"
          @click="activeTab = tab.id"
          class="flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors"
          :class="activeTab === tab.id ? 'bg-blue-500 text-white' : 'text-gray-600 hover:bg-gray-100'"
        >
          {{ tab.icon }} {{ tab.name }}
        </button>
      </div>

      <!-- éœ€æ±‚åˆ†ç±» -->
      <div v-show="activeTab === 'classify'" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="bg-white rounded-lg shadow-sm p-6">
          <h2 class="text-lg font-semibold mb-4">ğŸ“ è¾“å…¥éœ€æ±‚å†…å®¹</h2>
          <textarea 
            v-model="classifyInput"
            class="w-full h-40 p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
            placeholder="è¯·è¾“å…¥éœ€æ±‚æè¿°ï¼Œä¾‹å¦‚ï¼š&#10;ä¿¡è´·ç³»ç»Ÿç™»å½•é¡µé¢ç‚¹å‡»æŒ‰é’®æ— ååº”ï¼Œå½±å“ä¸šåŠ¡åŠç†..."
          ></textarea>
          <button 
            @click="classify"
            :disabled="loading.classify || !classifyInput.trim()"
            class="mt-4 w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"
          >
            {{ loading.classify ? 'åˆ†æä¸­...' : 'ğŸ” æ™ºèƒ½åˆ†ç±»' }}
          </button>
        </div>
        
        <div class="bg-white rounded-lg shadow-sm p-6">
          <h2 class="text-lg font-semibold mb-4">ğŸ“Š åˆ†ç±»ç»“æœ</h2>
          <div v-if="classifyResult" class="space-y-3">
            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
              <span class="text-gray-600">éœ€æ±‚ç±»å‹</span>
              <span class="px-3 py-1 rounded-full text-sm font-medium"
                :class="{
                  'bg-red-100 text-red-700': classifyResult.type === 'Bugä¿®å¤',
                  'bg-blue-100 text-blue-700': classifyResult.type === 'æ–°åŠŸèƒ½å¼€å‘',
                  'bg-yellow-100 text-yellow-700': classifyResult.type === 'è¿ç»´æ”¯æŒ',
                  'bg-green-100 text-green-700': classifyResult.type === 'å’¨è¯¢',
                  'bg-purple-100 text-purple-700': classifyResult.type === 'æ•°æ®éœ€æ±‚'
                }"
              >{{ classifyResult.type }}</span>
            </div>
            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
              <span class="text-gray-600">ç´§æ€¥ç¨‹åº¦</span>
              <span class="px-3 py-1 rounded-full text-sm font-medium"
                :class="{
                  'bg-red-100 text-red-700': classifyResult.urgency === 'ç´§æ€¥',
                  'bg-yellow-100 text-yellow-700': classifyResult.urgency === 'ä¸€èˆ¬',
                  'bg-green-100 text-green-700': classifyResult.urgency === 'ä½'
                }"
              >{{ classifyResult.urgency }}</span>
            </div>
            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
              <span class="text-gray-600">å»ºè®®éƒ¨é—¨</span>
              <span class="font-medium text-gray-800">{{ classifyResult.department }}</span>
            </div>
            <div class="p-3 bg-blue-50 rounded-lg">
              <span class="text-gray-600 text-sm">åˆ†ç±»ç†ç”±ï¼š</span>
              <p class="text-gray-800 mt-1">{{ classifyResult.reason }}</p>
            </div>
          </div>
          <div v-else class="text-gray-400 text-center py-12">
            ç­‰å¾…åˆ†æç»“æœ...
          </div>
        </div>
      </div>

      <!-- æ‘˜è¦ç”Ÿæˆ -->
      <div v-show="activeTab === 'summarize'" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="bg-white rounded-lg shadow-sm p-6">
          <h2 class="text-lg font-semibold mb-4">ğŸ“ è¾“å…¥éœ€æ±‚å†…å®¹</h2>
          <textarea 
            v-model="summarizeInput"
            class="w-full h-40 p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
            placeholder="è¯·è¾“å…¥è¾ƒé•¿çš„éœ€æ±‚æè¿°ï¼ŒAIå°†è‡ªåŠ¨æç‚¼è¦ç‚¹..."
          ></textarea>
          <button 
            @click="summarize"
            :disabled="loading.summarize || !summarizeInput.trim()"
            class="mt-4 w-full bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"
          >
            {{ loading.summarize ? 'ç”Ÿæˆä¸­...' : 'âœ¨ ç”Ÿæˆæ‘˜è¦' }}
          </button>
        </div>
        
        <div class="bg-white rounded-lg shadow-sm p-6">
          <h2 class="text-lg font-semibold mb-4">ğŸ“‹ æ‘˜è¦ç»“æœ</h2>
          <div v-if="summarizeResult" class="p-4 bg-green-50 rounded-lg">
            <pre class="whitespace-pre-wrap text-gray-800 font-sans">{{ summarizeResult }}</pre>
          </div>
          <div v-else class="text-gray-400 text-center py-12">
            ç­‰å¾…ç”Ÿæˆç»“æœ...
          </div>
        </div>
      </div>

      <!-- ç›¸ä¼¼æ£€ç´¢ -->
      <div v-show="activeTab === 'similar'" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="bg-white rounded-lg shadow-sm p-6">
          <h2 class="text-lg font-semibold mb-4">ğŸ“ è¾“å…¥éœ€æ±‚å†…å®¹</h2>
          <textarea 
            v-model="similarInput"
            class="w-full h-40 p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
            placeholder="è¾“å…¥æ–°éœ€æ±‚ï¼ŒæŸ¥æ‰¾å†å²ä¸Šç±»ä¼¼çš„éœ€æ±‚..."
          ></textarea>
          <button 
            @click="findSimilar"
            :disabled="loading.similar || !similarInput.trim()"
            class="mt-4 w-full bg-purple-500 text-white py-2 px-4 rounded-lg hover:bg-purple-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"
          >
            {{ loading.similar ? 'æ£€ç´¢ä¸­...' : 'ğŸ” æŸ¥æ‰¾ç›¸ä¼¼' }}
          </button>
        </div>
        
        <div class="bg-white rounded-lg shadow-sm p-6">
          <h2 class="text-lg font-semibold mb-4">ğŸ“š ç›¸ä¼¼éœ€æ±‚</h2>
          <div v-if="similarResult && similarResult.length > 0" class="space-y-3">
            <div v-for="(item, index) in similarResult" :key="index" 
              class="p-4 border rounded-lg hover:shadow-md transition-shadow">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium text-blue-600">{{ item.demand_id || 'æœªçŸ¥ID' }}</span>
                <span class="text-xs px-2 py-1 bg-gray-100 rounded-full">
                  ç›¸ä¼¼åº¦: {{ ((1 - item.score) * 100).toFixed(1) }}%
                </span>
              </div>
              <p class="text-gray-700 text-sm">{{ item.content }}</p>
            </div>
          </div>
          <div v-else-if="similarResult && similarResult.length === 0" class="text-gray-400 text-center py-12">
            æš‚æ— ç›¸ä¼¼éœ€æ±‚ï¼Œè¯·å…ˆå­˜å‚¨ä¸€äº›å†å²æ•°æ®
          </div>
          <div v-else class="text-gray-400 text-center py-12">
            ç­‰å¾…æ£€ç´¢ç»“æœ...
          </div>
        </div>
      </div>

      <!-- çŸ¥è¯†åº“ç®¡ç† -->
      <div v-show="activeTab === 'store'" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="bg-white rounded-lg shadow-sm p-6">
          <h2 class="text-lg font-semibold mb-4">ğŸ“¥ å­˜å‚¨éœ€æ±‚</h2>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">éœ€æ±‚ç¼–å·</label>
              <input 
                v-model="storeId"
                type="text"
                class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                placeholder="ä¾‹å¦‚ï¼šREQ-2024-001"
              >
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">éœ€æ±‚å†…å®¹</label>
              <textarea 
                v-model="storeContent"
                class="w-full h-32 p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                placeholder="è¾“å…¥éœ€æ±‚è¯¦ç»†å†…å®¹..."
              ></textarea>
            </div>
          </div>
          <button 
            @click="store"
            :disabled="loading.store || !storeId.trim() || !storeContent.trim()"
            class="mt-4 w-full bg-orange-500 text-white py-2 px-4 rounded-lg hover:bg-orange-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"
          >
            {{ loading.store ? 'å­˜å‚¨ä¸­...' : 'ğŸ’¾ å­˜å…¥çŸ¥è¯†åº“' }}
          </button>
        </div>
        
        <div class="bg-white rounded-lg shadow-sm p-6">
          <h2 class="text-lg font-semibold mb-4">ğŸ“Š çŸ¥è¯†åº“çŠ¶æ€</h2>
          <div class="space-y-4">
            <div class="p-4 bg-gray-50 rounded-lg">
              <div class="text-3xl font-bold text-blue-600">{{ stats.total_documents || 0 }}</div>
              <div class="text-sm text-gray-600">å·²å­˜å‚¨éœ€æ±‚æ•°</div>
            </div>
            <button 
              @click="refreshStats"
              class="w-full py-2 px-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
            >
              ğŸ”„ åˆ·æ–°ç»Ÿè®¡
            </button>
            
            <!-- å¿«é€Ÿå¯¼å…¥ç¤ºä¾‹æ•°æ® -->
            <div class="border-t pt-4">
              <p class="text-sm text-gray-600 mb-2">å¿«é€Ÿå¯¼å…¥ç¤ºä¾‹æ•°æ®ï¼š</p>
              <button 
                @click="importSampleData"
                :disabled="loading.import"
                class="w-full py-2 px-4 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"
              >
                {{ loading.import ? 'å¯¼å…¥ä¸­...' : 'ğŸ“¦ å¯¼å…¥æ¼”ç¤ºæ•°æ®' }}
              </button>
            </div>
          </div>
          
          <!-- æ“ä½œæ¶ˆæ¯ -->
          <div v-if="storeMessage" class="mt-4 p-3 rounded-lg text-sm"
            :class="storeMessage.type === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'">
            {{ storeMessage.text }}
          </div>
        </div>
      </div>
    </div>

    <!-- åº•éƒ¨ -->
    <footer class="text-center py-4 text-gray-500 text-sm">
      åŸºäº LangChain + Ollama + ChromaDB æ„å»º | MVP Demo
    </footer>
  </div>

  <script>
    const { createApp, ref, reactive, onMounted } = Vue

    const API_BASE = 'http://localhost:8000'

    createApp({
      setup() {
        const activeTab = ref('classify')
        const serverStatus = ref('offline')
        
        const tabs = [
          { id: 'classify', name: 'éœ€æ±‚åˆ†ç±»', icon: 'ğŸ·ï¸' },
          { id: 'summarize', name: 'æ‘˜è¦ç”Ÿæˆ', icon: 'âœ¨' },
          { id: 'similar', name: 'ç›¸ä¼¼æ£€ç´¢', icon: 'ğŸ”' },
          { id: 'store', name: 'çŸ¥è¯†åº“', icon: 'ğŸ“š' }
        ]

        const loading = reactive({
          classify: false,
          summarize: false,
          similar: false,
          store: false,
          import: false
        })

        // åˆ†ç±»
        const classifyInput = ref('')
        const classifyResult = ref(null)

        // æ‘˜è¦
        const summarizeInput = ref('')
        const summarizeResult = ref(null)

        // ç›¸ä¼¼
        const similarInput = ref('')
        const similarResult = ref(null)

        // å­˜å‚¨
        const storeId = ref('')
        const storeContent = ref('')
        const storeMessage = ref(null)
        const stats = reactive({ total_documents: 0 })

        // API è°ƒç”¨
        async function fetchAPI(endpoint, data) {
          const response = await fetch(`${API_BASE}${endpoint}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          })
          return response.json()
        }

        async function classify() {
          loading.classify = true
          classifyResult.value = null
          try {
            const res = await fetchAPI('/classify', { content: classifyInput.value })
            if (res.success) {
              classifyResult.value = res.data
            } else {
              alert('åˆ†ç±»å¤±è´¥ï¼š' + (res.error || 'æœªçŸ¥é”™è¯¯'))
            }
          } catch (e) {
            alert('è¯·æ±‚å¤±è´¥ï¼š' + e.message)
          } finally {
            loading.classify = false
          }
        }

        async function summarize() {
          loading.summarize = true
          summarizeResult.value = null
          try {
            const res = await fetchAPI('/summarize', { content: summarizeInput.value })
            if (res.success) {
              summarizeResult.value = res.summary
            } else {
              alert('ç”Ÿæˆå¤±è´¥ï¼š' + (res.error || 'æœªçŸ¥é”™è¯¯'))
            }
          } catch (e) {
            alert('è¯·æ±‚å¤±è´¥ï¼š' + e.message)
          } finally {
            loading.summarize = false
          }
        }

        async function findSimilar() {
          loading.similar = true
          similarResult.value = null
          try {
            const res = await fetchAPI('/similar', { content: similarInput.value })
            if (res.success) {
              similarResult.value = res.similar_demands
            } else {
              alert('æ£€ç´¢å¤±è´¥ï¼š' + (res.error || 'æœªçŸ¥é”™è¯¯'))
            }
          } catch (e) {
            alert('è¯·æ±‚å¤±è´¥ï¼š' + e.message)
          } finally {
            loading.similar = false
          }
        }

        async function store() {
          loading.store = true
          storeMessage.value = null
          try {
            const res = await fetchAPI('/store', { 
              demand_id: storeId.value, 
              content: storeContent.value 
            })
            if (res.success) {
              storeMessage.value = { type: 'success', text: 'å­˜å‚¨æˆåŠŸï¼' }
              storeId.value = ''
              storeContent.value = ''
              refreshStats()
            } else {
              storeMessage.value = { type: 'error', text: 'å­˜å‚¨å¤±è´¥ï¼š' + (res.message || 'æœªçŸ¥é”™è¯¯') }
            }
          } catch (e) {
            storeMessage.value = { type: 'error', text: 'è¯·æ±‚å¤±è´¥ï¼š' + e.message }
          } finally {
            loading.store = false
          }
        }

        async function refreshStats() {
          try {
            const response = await fetch(`${API_BASE}/stats`)
            const data = await response.json()
            if (data.vector_db) {
              stats.total_documents = data.vector_db.total_documents || 0
            }
          } catch (e) {
            console.error('è·å–ç»Ÿè®¡å¤±è´¥', e)
          }
        }

        async function checkHealth() {
          try {
            const response = await fetch(`${API_BASE}/health`)
            const data = await response.json()
            serverStatus.value = data.status === 'healthy' ? 'online' : 'offline'
          } catch (e) {
            serverStatus.value = 'offline'
          }
        }

        async function importSampleData() {
          loading.import = true
          const sampleData = [
            { demand_id: 'REQ-2024-001', content: 'å®¢æˆ·ä¿¡æ¯æ‰¹é‡å¯¼å…¥åŠŸèƒ½å¼€å‘ï¼Œæ”¯æŒExcelæ ¼å¼ä¸Šä¼ ï¼Œå•æ¬¡æœ€å¤š1000æ¡è®°å½•ï¼Œéœ€è¦åšæ•°æ®æ ¡éªŒå’Œå»é‡å¤„ç†' },
            { demand_id: 'REQ-2024-002', content: 'ä¿¡è´·å®¡æ‰¹æµç¨‹ä¼˜åŒ–ï¼Œé’ˆå¯¹å°é¢è´·æ¬¾ï¼ˆ5ä¸‡ä»¥ä¸‹ï¼‰å¢åŠ è‡ªåŠ¨å®¡æ‰¹è§„åˆ™ï¼Œå‡å°‘äººå·¥å®¡æ ¸ç¯èŠ‚' },
            { demand_id: 'REQ-2024-003', content: 'å¼€å‘å®¢æˆ·äº¤æ˜“æ˜ç»†æ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼Œæ”¯æŒæŒ‰æ—¶é—´èŒƒå›´ç­›é€‰ï¼Œå¯¼å‡ºä¸ºExcelæ ¼å¼' },
            { demand_id: 'REQ-2024-004', content: 'ç§»åŠ¨ç«¯APPå¢åŠ äººè„¸è¯†åˆ«ç™»å½•åŠŸèƒ½ï¼Œæ¥å…¥å…¬å®‰éƒ¨èº«ä»½æ ¸éªŒæ¥å£ï¼Œæå‡è´¦æˆ·å®‰å…¨æ€§' },
            { demand_id: 'REQ-2024-005', content: 'æŠ¥è¡¨ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–ï¼Œæœˆæœ«è·‘æ‰¹æŠ¥è¡¨ç”Ÿæˆæ—¶é—´ä»2å°æ—¶ç¼©çŸ­åˆ°30åˆ†é’Ÿä»¥å†…' },
            { demand_id: 'REQ-2024-006', content: 'åæ´—é’±ç³»ç»Ÿå¤§é¢äº¤æ˜“é¢„è­¦åŠŸèƒ½ï¼Œå•ç¬”è¶…5ä¸‡æˆ–å½“æ—¥ç´¯è®¡è¶…20ä¸‡è‡ªåŠ¨è§¦å‘é¢„è­¦' }
          ]

          try {
            for (const item of sampleData) {
              await fetchAPI('/store', item)
            }
            storeMessage.value = { type: 'success', text: `æˆåŠŸå¯¼å…¥ ${sampleData.length} æ¡ç¤ºä¾‹æ•°æ®ï¼` }
            refreshStats()
          } catch (e) {
            storeMessage.value = { type: 'error', text: 'å¯¼å…¥å¤±è´¥ï¼š' + e.message }
          } finally {
            loading.import = false
          }
        }

        onMounted(() => {
          checkHealth()
          refreshStats()
          // å®šæ—¶æ£€æŸ¥æœåŠ¡çŠ¶æ€
          setInterval(checkHealth, 30000)
        })

        return {
          activeTab,
          serverStatus,
          tabs,
          loading,
          classifyInput,
          classifyResult,
          summarizeInput,
          summarizeResult,
          similarInput,
          similarResult,
          storeId,
          storeContent,
          storeMessage,
          stats,
          classify,
          summarize,
          findSimilar,
          store,
          refreshStats,
          importSampleData
        }
      }
    }).mount('#app')
  </script>
</body>
</html>
